<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<link href="http://www.tpshop.com/static/css/shop.css" type="text/css" rel="stylesheet" />
<link href="http://www.tpshop.com/static/css/Sellerber.css" type="text/css"  rel="stylesheet" />
<link href="http://www.tpshop.com/static/css/bkg_ui.css" type="text/css"  rel="stylesheet" />
<link href="http://www.tpshop.com/static/font/css/font-awesome.min.css"  rel="stylesheet" type="text/css" />
<script src="http://www.tpshop.com/static/js/jquery-1.9.1.min.js" type="text/javascript" ></script>
<script src="http://www.tpshop.com/static/js/Sellerber.js" type="text/javascript"></script>
<script src="http://www.tpshop.com/static/js/jquery.dataTables.min.js"></script>
<script src="http://www.tpshop.com/static/js/jquery.dataTables.bootstrap.js"></script>
<script src="http://www.tpshop.com/static/js/layer/layer.js" type="text/javascript"></script>
<script src="http://www.tpshop.com/static/js/laydate/laydate.js" type="text/javascript"></script>
<!--[if lt IE 9]>
<script src="http://www.tpshop.com/static/js/html5shiv.js" type="text/javascript"></script>
<script src="http://www.tpshop.com/static/js/respond.min.js"></script>
<script src="http://www.tpshop.com/static/js/css3-mediaqueries.js"  type="text/javascript"></script>
  <![endif]-->
<title>添加商品</title>
</head>

<body>
<div class="margin">
<div class="add_style">
 <ul>
  <li class="clearfix"><label class="label_name col-xs-1"><i>*</i>商品名称：&nbsp;&nbsp;</label><div class="Add_content col-xs-11"><input name="g_name" type="text"  class="col-xs-6"/></div></li>
  <li class="clearfix"><label class="label_name col-xs-1"><i>*</i>商品编号：&nbsp;&nbsp;</label><div class="Add_content col-xs-11"><input name="g_num" type="text" class="col-xs-4"/></div></li>
  <li class="clearfix"><label class="label_name col-xs-1"><i>*</i>简单描述：&nbsp;&nbsp;</label><div class="Add_content col-xs-11"><input name="g_remark" type="text" class="col-xs-4"/></div></li>
   <li class="clearfix"><label class="label_name col-xs-1"><i>*</i>关&nbsp;键&nbsp;字：&nbsp;&nbsp;</label><div class="Add_content col-xs-11"><input name="keyword" type="text" class="col-xs-4"/><em class="Prompt"> 请用","分隔关键字</em></div></li>
  <li class="clearfix">
  <label class="label_name col-xs-1"><i>*</i>产品分类：&nbsp;&nbsp;</label>
  <div class="col-sm-4" style="width: 220px">
   <select class="form-control" style=" width:200px" id="cla_fid">
    <option selected value="0">请选择商品分类</option>
    {volist name="re" id="v"}
    <option value="{$v.cla_id}">{$v.cla_name}</option>
    {/volist}
   </select>
  </div>
  <div class="col-sm-4" style="float: left;width:220px">
   <select class="form-control" style=" width:200px" id="cla_fid_s">
    <option selected>请选择商品分类</option>
   </select>
  </div>
  <div class="col-sm-4" style="float: left">
   <select class="form-control" style=" width:200px" id="cla_fid_s1">
    <option selected>请选择商品分类</option>
   </select>
  </div>
 </li>
  <li class="clearfix">
   <label class="label_name col-xs-1"><i>*</i>所属品牌：&nbsp;&nbsp;</label>
   <div class="col-sm-4" style="width: 220px">
    <select class="form-control" style=" width:200px" id="brand">
     <option selected value="0">请选择商品品牌</option>
     {volist name="se" id="s"}
     <option value="{$s.b_id}">{$s.b_name}</option>
     {/volist}
    </select>
   </div>
  </li>
     <li class="clearfix">
      <div class="col-xs-4">
     <label class="label_name col-xs-3"><i>*</i>商品价格：&nbsp;&nbsp;</label>
    <div class="Add_content col-xs-9">
    <input name="g_pri" type="text"  class="col-xs-7"/><em class="Prompt">元</em>
    </div>   
    </div>
    <div class="col-xs-4">
    <label class="label_name col-xs-3"><i>*</i>商品重量：&nbsp;&nbsp;</label>
    <div class="Add_content col-xs-9">
   <input name="weight" type="text"  class="col-xs-7"/><em class="Prompt">kg</em>
    </div>   
    </div>
    </li>
     <li class="clearfix">
      <div class="col-xs-4" style="width: 250px">
     <label class="label_name col-xs-3" style="width: 100px" >是否上架：&nbsp;&nbsp;</label>
    <div class="Add_content col-xs-9" style="width: 100px">
    <label><input type="radio" name="is_on_sale" class="ace" checked="checked" value="1"><span class="lbl">是</span></label>
    <label><input type="radio" name="is_on_sale" class="ace" value="0"><span class="lbl">否</span></label>
    </div>   
    </div>
      <div class="col-xs-4" style="width: 250px">
       <label class="label_name col-xs-3" style="width: 100px">是否推荐：&nbsp;&nbsp;</label>
       <div class="Add_content col-xs-9" style="width: 100px">
        <label><input type="radio" name="is_recommend" class="ace" checked="checked" value="1"><span class="lbl">是</span></label>
        <label><input type="radio" name="is_recommend" class="ace" value="0"><span class="lbl">否</span></label>
       </div>
      </div>
      <div class="col-xs-4" style="width: 250px">
       <label class="label_name col-xs-3" style="width: 100px">是否新品：&nbsp;&nbsp;</label>
       <div class="Add_content col-xs-9" style="width: 100px">
        <label><input type="radio" name="is_new" class="ace" checked="checked" value="1"><span class="lbl">是</span></label>
        <label><input type="radio" name="is_new" class="ace" value="0"><span class="lbl">否</span></label>
       </div>
      </div>
      <div class="col-xs-4" style="width: 250px">
       <label class="label_name col-xs-3" style="width: 100px">是否包邮：&nbsp;&nbsp;</label>
       <div class="Add_content col-xs-9" style="width: 100px">
        <label><input type="radio" name="is_free_shipping" class="ace" checked="checked" value="1"><span class="lbl">是</span></label>
        <label><input type="radio" name="is_free_shipping" class="ace" value="0"><span class="lbl">否</span></label>
       </div>
      </div>
    </li>
  <li class="clearfix">
   <label class="label_name col-xs-1" ><i>*</i>商品图片：&nbsp;&nbsp;</label>
   <div class="Add_content col-xs-11"><input name="original_img" type="file" id="b_logo"  class="col-xs-6" /></div>
   <div>
    <img src="" id="img" width="100" height="100">
   </div>
  </li>
     <li class="clearfix"><label class="label_name col-xs-1"><i>*</i>内容介绍：&nbsp;&nbsp;</label>
     <div class="Add_content col-xs-11"><script id="container" name="content" type="text/plain" style="width:80%;height:500px;"></script></div>
     </li>  
 </ul>
 <div class="Button_operation btn_width">
    <button class="btn button_btn bg-deep-blue" type="button">保存并提交</button>
    <button class="btn button_btn bg-orange" type="button">保存草稿</button>
    <button class="btn button_btn bg-gray" type="button">取消添加</button>
 </div>
</div>
</div>


<script type="text/javascript">
    $("input[name='original_img']").change(function(){
        var objUrl = getObjectURL(this.files[0]);
        if(objUrl){
            $('#img').attr('src',objUrl);
        }
    });
    function getObjectURL(file) {
        var url = null ;
        if (window.createObjectURL!=undefined) { // basic
            url = window.createObjectURL(file) ;
        } else if (window.URL!=undefined) { // mozilla(firefox)
            url = window.URL.createObjectURL(file) ;
        } else if (window.webkitURL!=undefined) { // webkit or chrome
            url = window.webkitURL.createObjectURL(file) ;
        }
        return url ;
    }
    $('#cla_fid').change(function () {
        var cla_id = $(this).val();
        if(cla_id != 0){
            $.ajax({
                url:"http://www.tpshop.com/Admin/Goods/select_next",
                type:'POST',
                async:true,
                data:{
                    'cla_id':cla_id
                },
                timeout:5000,
                dataType:'json',
                success:function(data){
                    if(data.length != 0) {
                        $('#cla_fid_s').empty();
                        $('#cla_fid_s').append("<option>请选择商品分类</option>");
                        for(i=0;i<data.length;i++){
                            $('#cla_fid_s').append("<option value='"+data[i].cla_id+"'>"+data[i].cla_name+"</option>");
                        }

                    }else {
                        $('#cla_fid_s').empty();
                        $('#cla_fid_s').append("<option>请选择商品分类</option>");
                    }
                }
            });
        }else {
            $('#cla_fid_s').empty();
            $('#cla_fid_s').append("<option value='0'>请选择商品分类</option>");
        }
    })
    $('#cla_fid_s').change(function () {
        var cla_id = $(this).val();
        if(cla_id != 0){
            $.ajax({
                url:"http://www.tpshop.com/Admin/Goods/select_next",
                type:'POST',
                async:true,
                data:{
                    'cla_id':cla_id
                },
                timeout:5000,
                dataType:'json',
                success:function(data){
                    if(data.length != 0) {
                        $('#cla_fid_s1').empty();
                        $('#cla_fid_s1').append("<option>请选择商品分类</option>");
                        for(i=0;i<data.length;i++){
                            $('#cla_fid_s1').append("<option value='"+data[i].cla_id+"'>"+data[i].cla_name+"</option>");
                        }

                    }else {
                        $('#cla_fid_s1').empty();
                        $('#cla_fid_s1').append("<option>请选择商品分类</option>");
                    }
                }
            });
        }else {
            $('#cla_fid_s1').empty();
            $('#cla_fid_s1').append("<option value='0'>请选择商品分类</option>");
        }
    })
</script>
</body>
</html>
<script type="text/javascript" src="http://www.tpshop.com/static/js/utf8-php/ueditor.config.js"></script>
<script type="text/javascript" src="http://www.tpshop.com/static/js/utf8-php/ueditor.all.js"></script>
<script type="text/javascript" >
    var ue = UE.getEditor('container');
    $('.bg-deep-blue').click(function(){
        var ghtml = UE.getEditor('container').getContent();
        var g_name = $('input[name="g_name"]').val();//商品名称
        var g_num = $('input[name="g_num"]').val();//商品编号
        var g_remark = $('input[name="g_remark"]').val();//简单描述
        var keyword = $('input[name="keyword"]').val();//关键字
        var g_pri = $('input[name="g_pri"]').val();//商品价格
        var weight = $('input[name="weight"]').val();//商品重量
        var brand_id = $('#brand').val();//品牌ID

        var is_on_sale = $('input:radio[name="is_on_sale"]:checked').val();//是否上架
        var is_recommend = $('input:radio[name="is_recommend"]:checked').val();//是否推荐
        var is_new = $('input:radio[name="is_new"]:checked').val();//是否新品
        var is_free_shipping = $('input:radio[name="is_free_shipping"]:checked').val();//是否包邮
        if($("#cla_fid_s1").val() != "请选择商品分类"){
            var cla_id = $("#cla_fid_s1").val();
        }else if($("#cla_fid_s").val() != "请选择商品分类"){
            var cla_id = $("#cla_fid_s").val();
        }else if($("#cla_fid").val() != "0"){
            var cla_id = $("#cla_fid").val();
        }else {
            var cla_id = 0;
        }
        if(g_name.length==0){
            layer.alert('请填写商品名称');
        }else if(g_num.length==0){
            layer.alert('请填写商品编号');
        }else if(g_remark.length==0){
            layer.alert('请填写商品描述');
        }else if(keyword.length==0){
            layer.alert('请填写商品关键字');
        }else if(g_pri.length==0){
            layer.alert('请填写商品价格');
        }else if(weight.length==0){
            layer.alert('请填写商品重量');
        }else if(cla_id==0){
            layer.alert('请选择商品分类');
        }else if(brand_id==0){
            layer.alert('请选择品牌分类');
        }else {
            var formdata = new FormData();
            // 将文件追加到 formdata对象中。
            formdata.append("myfile", document.getElementById('b_logo').files[0]);
            $.ajax({
                type: "POST",
                url: "http://www.tpshop.com/Admin/Goods/uploadGoodImg",
                data: formdata,
                /**
                 * 必须false才会避开jQuery对 formdata 的默认处理
                 * XMLHttpRequest会对 formdata 进行正确的处理
                 */
                processData: false,
                // 告诉jQuery不要去设置Content-Type请求头
                contentType: false,
                dataType: "json",
                success: function (data) {
                    console.log(data);
                    var b_logo = data.mes;

                    $.ajax({
                        url: "http://www.tpshop.com/Admin/Goods/addGoodsinfo",
                        type: "POST",
                        data: {
                            'g_name': g_name,
                            'g_num': g_num,
                            'g_remark': g_remark,
                            'keyword': keyword,
                            'g_pri': g_pri,
                            'weight': weight,
                            'brand_id': brand_id,
                            'cla_id': cla_id,
                            'original_img':b_logo,
                            'g_content':ghtml,
                            'is_on_sale':is_on_sale,
                            'is_recommend':is_recommend,
                            'is_new':is_new,
                            'is_free_shipping':is_free_shipping
                        },
                        async: true,
                        timeout: 5000,
                        dataType: 'json',
                        success: function (data) {
                            console.log(data);
                            if (data.sess == 1) {
                                layer.alert(data.mess, {
                                    btn: ['继续添加'] //按钮
                                }, function () {
                                    window.location.reload();
                                });
                            } else {
                                layer.alert(data.mess);
                            }
                        }, error: function (jqXHR) {
                            console.log("发生错误：" + jqXHR);
                        }
                    });
                }
            })
        }
    });

</script>
<script>
 /*checkbox激发事件*/
$('#checkbox').on('click',function(){
	if($('input[name="checkbox"]').prop("checked")){
		 $('.Date_selection ').css('display','block');
		}
	else{
		
		 $('.Date_selection').css('display','none');
		}	
	});
/*********滚动事件*********/
$("body").niceScroll({  
	cursorcolor:"#888888",  
	cursoropacitymax:1,  
	touchbehavior:false,  
	cursorwidth:"5px",  
	cursorborder:"0",  
	cursorborderradius:"5px"  
});
</script>
